## 一、官方客户端 Pinia 状态管理的作用

官方客户端使用 Pinia 管理以下**三类状态**：

### 1. 文件状态 ([`file.ts`](D:\Downloads\cherry-markdown-cherry-markdown-0.10.3\packages\client\src\store\modal\file.ts))

| 状态字段 | 用途 |
|---------|------|
| `currentFilePath` | 当前打开文件路径 |
| `recentFiles` | 最近打开文件列表（最多50个） |
| `sidebarCollapsed` | 侧边栏折叠状态 |
| `isDirty` | 文件是否未保存 |
| `currentFileAccessTime` | 文件访问时间戳 |

**核心功能：**
- 最近文件管理（添加/删除/排序）
- 路径持久化到 localStorage（下次启动自动恢复）
- 侧边栏状态持久化

### 2. 目录状态 ([`directory.ts`](D:\Downloads\cherry-markdown-cherry-markdown-0.10.3\packages\client\src\store\modal\directory.ts))

| 功能 | 用途 |
|------|------|
| 目录缓存 | 缓存目录结构避免重复加载 |
| 展开/收起状态 | 记忆各目录的展开状态 |
| 当前目录 | 记录当前浏览的根目录 |

---

## 二、能否引进 Pinia？用于何处？如何利用？

### ✅ 建议引进，但有前提

**当前方案 vs Pinia 方案对比：**

| 方面 | 当前 (reactive/ref) | 引入 Pinia |
|------|---------------------|------------|
| 代码量 | 极少（约60行） | 较多（需配置Store） |
| TypeScript支持 | ✅ | ✅ 更完善 |
| 持久化 | ❌ 需自行实现 | `pinia-plugin-persistedstate` |
| 多Store组织 | ❌ | ✅ 清晰分离 |
| 开发调试 | 有限 | Vue DevTools 完整支持 |

### 📍 建议引入的场景

1. **需要状态持久化**
   - 记住上次打开的标签页（崩溃恢复）
   - 记住每个标签页的编辑模式偏好
   - 记住窗口大小/主题设置

2. **需要跨组件共享复杂状态**
   - 最近文件列表（在TabBar、菜单等处共享）
   - 文件过滤/搜索状态
   - 编辑器配置（主题、字体大小）

3. **需要更规范的项目结构**
   - 业务逻辑与UI分离
   - 可测试的状态逻辑
   - 多人协作的代码一致性

### 🛠️ 具体利用方案

#### 渐进式引入（推荐）

```
当前状态 ──────────────────────────────────────────────────► Pinia

┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ reactive/ref │ ➜  │ 混合模式     │ ➜  │ 全Pinia      │
│ tabStore     │    │ + 持久化插件 │    │              │
└──────────────┘    └──────────────┘    └──────────────┘
     现状              快速增强            完整迁移
```

**步骤：**
1. 安装 Pinia + 持久化插件
2. 将 `tabStore` 改造为 Pinia Store
3. 新增 `useSettingsStore` 管理主题、编辑器配置
4. 新增 `useRecentFilesStore` 管理最近文件

### 🎯 优先级建议

| 优先级 | 功能 | 收益 |
|--------|------|------|
| ⭐ 高 | 标签页状态持久化 | 崩溃恢复、用户体验提升 |
| ⭐ 高 | 最近文件列表 | 快速打开历史文件 |
| ⚡ 中 | 编辑器配置持久化 | 主题/字体偏好记忆 |

### ⚠️ 不建议引入的情况

如果项目保持**轻量级定位**，当前方案已足够，因为 `tabStore` 仅 64 行代码，功能完善，官方文档也建议："Pinia 迁移：当前轻量级方案已足够"

**总结：Pinia 是可选增强，非必需。** 建议根据"是否需要持久化"和"项目规模增长"两个因素决定是否引入。