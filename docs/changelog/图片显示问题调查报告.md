# Preview æ¨¡å¼å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜è°ƒæŸ¥æŠ¥å‘Š

**æ—¥æœŸ**: 2025-01-26
**é—®é¢˜**: Cherry Markdown åœ¨ previewOnly æ¨¡å¼ä¸‹æ— æ³•æ˜¾ç¤ºç›¸å¯¹è·¯å¾„å›¾ç‰‡
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## ä¸€ã€é—®é¢˜ç°è±¡

### 1.1 åˆå§‹é—®é¢˜

åœ¨ Cherry Markdown Desktop ä¸­ï¼Œå½“ Markdown æ–‡ä»¶åŒ…å«ç›¸å¯¹è·¯å¾„å›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼š

```markdown
![æ•°æ®åˆ†æç•Œé¢-1](images/image_0001.png)
```

**é¢„æœŸè¡Œä¸º**: å›¾ç‰‡åº”è¯¥æ­£å¸¸æ˜¾ç¤º
**å®é™…è¡Œä¸º**: å›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œæµè§ˆå™¨æ§åˆ¶å°å‡ºç°é”™è¯¯

### 1.2 é”™è¯¯ä¿¡æ¯æ¼”å˜

åœ¨è°ƒæŸ¥å’Œä¿®å¤è¿‡ç¨‹ä¸­ï¼Œé”™è¯¯ä¿¡æ¯ç»å†äº†ä»¥ä¸‹å˜åŒ–ï¼š

| é˜¶æ®µ | é”™è¯¯ä¿¡æ¯ | è¯´æ˜ |
|------|---------|------|
| åˆå§‹çŠ¶æ€ | å›¾ç‰‡ä¸æ˜¾ç¤ºï¼Œæ— æ§åˆ¶å°é”™è¯¯ | ç¼ºå°‘ `urlProcessor` å›è°ƒ |
| ç¬¬ä¸€ç‰ˆä¿®å¤ | `net::ERR_CONNECTION_REFUSED` | asset protocol æœªå¯ç”¨ |
| ç¬¬äºŒç‰ˆä¿®å¤ | `Failed to load resource: 500 (Internal Server Error)` | è·¯å¾„æ ¼å¼ä¸æ­£ç¡® |

---

## äºŒã€æ ¹å› åˆ†æ

### 2.1 æ ¸å¿ƒé—®é¢˜

é€šè¿‡åˆ†æ CherryEditor.vue çš„é…ç½®ï¼Œå‘ç°ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

1. **ç¼ºå°‘ `urlProcessor` å›è°ƒé…ç½®**
   - Cherry Markdown åœ¨ previewOnly æ¨¡å¼ä¸‹éœ€è¦é€šè¿‡ `urlProcessor` å›è°ƒæ¥å¤„ç†å›¾ç‰‡ URL
   - å½“å‰é…ç½®ä¸­æ²¡æœ‰è¿™ä¸ªå›è°ƒï¼Œå¯¼è‡´ç›¸å¯¹è·¯å¾„å›¾ç‰‡æ— æ³•è¢«æ­£ç¡®è§£æ

2. **Tauri asset protocol æœªå¯ç”¨**
   - Tauri 2.0 éœ€è¦åœ¨ `tauri.conf.json` ä¸­å¯ç”¨ `assetProtocol` æ‰èƒ½è®¿é—®æœ¬åœ°æ–‡ä»¶
   - æœªå¯ç”¨æ—¶ï¼Œä»»ä½•é€šè¿‡ `convertFileSrc` è½¬æ¢çš„ URL éƒ½ä¼šè¿”å› `ERR_CONNECTION_REFUSED`

3. **è·¯å¾„æ ¼å¼é—®é¢˜**
   - `convertFileSrc` åœ¨ Windows ä¸Šå¯¹è·¯å¾„æ ¼å¼æœ‰ç‰¹æ®Šè¦æ±‚
   - é”™è¯¯çš„è·¯å¾„æ ¼å¼ä¼šå¯¼è‡´ 500 é”™è¯¯

### 2.2 é—®é¢˜å®šä½è¿‡ç¨‹

#### æ­¥éª¤ 1: æ£€æŸ¥ Cherry Markdown é…ç½®

æŸ¥çœ‹ `src/components/CherryEditor.vue` çš„ callback é…ç½®ï¼š

```javascript
callback: {
  onClickPreview: (e) => { ... },
  afterChange: (newContent) => { ... },
  afterInit: () => { ... },
  // âŒ ç¼ºå°‘ urlProcessor å›è°ƒï¼
}
```

**ç»“è®º**: ç¼ºå°‘ `urlProcessor` å›è°ƒæ˜¯æ ¹æœ¬åŸå› ã€‚

#### æ­¥éª¤ 2: å‚è€ƒå®˜æ–¹æ–‡æ¡£

æŸ¥çœ‹ Cherry Markdown å®˜æ–¹ç¤ºä¾‹ï¼Œå‘ç°æ‰€æœ‰æ¶‰åŠå›¾ç‰‡çš„åœºæ™¯éƒ½é…ç½®äº† `urlProcessor`ï¼š

```javascript
callback: {
  urlProcessor: (url, type) => {
    console.log('åŠ è½½å›¾ç‰‡', '/@fs/' + __EXAMPLES_PATH__ + '/' + url);
    return '/@fs/' + __EXAMPLES_PATH__ + '/' + url;
  }
}
```

**ç»“è®º**: å¿…é¡»æ·»åŠ  `urlProcessor` å›è°ƒæ¥å¤„ç†å›¾ç‰‡è·¯å¾„ã€‚

#### æ­¥éª¤ 3: ç†è§£ Tauri ç¯å¢ƒç‰¹æ®Šæ€§

åœ¨ Tauri æ¡Œé¢åº”ç”¨ä¸­ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨æ–‡ä»¶è·¯å¾„ï¼Œéœ€è¦ï¼š
1. å°†ç›¸å¯¹è·¯å¾„è§£æä¸ºç»å¯¹è·¯å¾„
2. ä½¿ç”¨ Tauri çš„ `convertFileSrc` API å°†æœ¬åœ°æ–‡ä»¶è·¯å¾„è½¬æ¢ä¸º WebView å¯è®¿é—®çš„ URL

**ç»“è®º**: éœ€è¦ç»“åˆè·¯å¾„è§£æå’Œ Tauri API ä½¿ç”¨ã€‚

---

## ä¸‰ã€è§£å†³æ–¹æ¡ˆ

### 3.1 åˆ›å»ºè·¯å¾„è§£æå·¥å…·æ¨¡å—

**æ–‡ä»¶**: `src/utils/pathUtils.ts`

**åŠŸèƒ½**: æä¾›è·¨å¹³å°çš„ç›¸å¯¹è·¯å¾„è§£æåŠŸèƒ½

```typescript
/**
 * è§£æç›¸å¯¹è·¯å¾„ï¼Œæ­£ç¡®å¤„ç† . å’Œ ..
 * @param fromPath åŸºå‡†è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰
 * @returns è§£æåçš„ç»å¯¹è·¯å¾„ï¼ˆä¿æŒåŸå§‹è·¯å¾„åˆ†éš”ç¬¦æ ¼å¼ï¼‰
 */
export function resolvePath(fromPath: string, relativePath: string): string {
  // æ£€æµ‹æ˜¯å¦ä¸º Windows è·¯å¾„
  const isWindowsPath = /^[A-Za-z]:/.test(fromPath);

  // å°†è·¯å¾„ç»Ÿä¸€è½¬æ¢ä¸º / æ ¼å¼è¿›è¡Œè§£æï¼ˆä¾¿äºå¤„ç†ï¼‰
  const normalizedFrom = fromPath.replace(/\\/g, '/');
  const normalizedRelative = relativePath.replace(/\\/g, '/');

  // æå–åŸºå‡†ç›®å½•
  const baseDir = normalizedFrom.substring(0, normalizedFrom.lastIndexOf('/'));

  // æ‰‹åŠ¨è§£æç›¸å¯¹è·¯å¾„ï¼Œé¿å… new URL() å¯¼è‡´çš„åŒé‡ç¼–ç é—®é¢˜
  const parts = baseDir.split('/');
  const relativeParts = normalizedRelative.split('/');

  for (const part of relativeParts) {
    if (part === '' || part === '.') {
      continue; // è·³è¿‡ç©ºè·¯å¾„å’Œå½“å‰ç›®å½•
    } else if (part === '..') {
      parts.pop(); // è¿”å›ä¸Šçº§ç›®å½•
    } else {
      parts.push(part); // æ·»åŠ è·¯å¾„éƒ¨åˆ†
    }
  }

  let resolvedPath = parts.join('/');

  // Windows è·¯å¾„å¤„ç†ï¼šæ¢å¤åæ–œæ æ ¼å¼
  if (isWindowsPath) {
    if (resolvedPath.startsWith('/')) {
      resolvedPath = resolvedPath.substring(1);
    }
    resolvedPath = resolvedPath.replace(/\//g, '\\');
  }

  return resolvedPath;
}
```

**è®¾è®¡è¦ç‚¹**:
- âœ… é¿å…ä½¿ç”¨ `new URL()` è¿›è¡Œè·¯å¾„è§£æï¼Œé˜²æ­¢ä¸­æ–‡è·¯å¾„è¢«åŒé‡ç¼–ç 
- âœ… æ­£ç¡®å¤„ç† `.` å’Œ `..` ç›¸å¯¹è·¯å¾„
- âœ… åœ¨ Windows ä¸Šè¿”å›åæ–œæ æ ¼å¼è·¯å¾„ï¼ˆ`convertFileSrc` çš„è¦æ±‚ï¼‰

### 3.2 é…ç½® Tauri asset protocol

**æ–‡ä»¶**: `src-tauri/tauri.conf.json`

**ä¿®æ”¹å†…å®¹**:

```json
{
  "app": {
    "security": {
      "csp": "default-src 'self' ipc: http://ipc.localhost; img-src 'self' asset: http://asset.localhost data: https:; connect-src 'self' ipc: http://ipc.localhost https:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'",
      "assetProtocol": {
        "enable": true,
        "scope": ["**"]
      }
    }
  }
}
```

**é…ç½®è¯´æ˜**:
1. **CSP é…ç½®**:
   - `img-src` ä¸­æ·»åŠ  `asset:` å’Œ `http://asset.localhost`ï¼Œå…è®¸åŠ è½½ asset protocol
   - `script-src` ä¸­æ·»åŠ  `'unsafe-inline'` å’Œ `'unsafe-eval'`ï¼Œç¡®ä¿ Cherry Markdown æ­£å¸¸å·¥ä½œ

2. **assetProtocol é…ç½®**:
   - `enable: true`: å¯ç”¨ asset protocolï¼ˆå¿…é¡»ï¼ï¼‰
   - `scope: ["**"]`: å…è®¸è®¿é—®æ‰€æœ‰æ–‡ä»¶è·¯å¾„

**å‚è€ƒ**: [Tauri Core Documentation - convertFileSrc](https://v2.tauri.app/reference/javascript/api/namespacecore/)

### 3.3 æ·»åŠ  urlProcessor å›è°ƒ

**æ–‡ä»¶**: `src/components/CherryEditor.vue`

**å¯¼å…¥ä¾èµ–**:

```typescript
import { convertFileSrc } from '@tauri-apps/api/core';
import { resolvePath } from '../utils/pathUtils';
```

**æ·»åŠ  urlProcessor å›è°ƒ**:

```typescript
callback: {
  urlProcessor: (url: string, srcType: string) => {
    // å¦‚æœæ˜¯ http/https/data é“¾æ¥ï¼Œç›´æ¥è¿”å›
    if (/^(https?:|data:)/.test(url)) {
      return url;
    }

    // è·å–å½“å‰æ–‡ä»¶è·¯å¾„
    const currentFilePath = props.tab?.filePath;

    // å¦‚æœæ˜¯ untitled æ–‡ä»¶ï¼ˆæœªä¿å­˜ï¼‰ï¼Œæ— æ³•è§£æç›¸å¯¹è·¯å¾„
    if (!currentFilePath || currentFilePath.startsWith('untitled')) {
      return url;
    }

    try {
      // è§£æç›¸å¯¹è·¯å¾„ä¸ºç»å¯¹è·¯å¾„
      const absolutePath = resolvePath(currentFilePath, url);

      // è½¬æ¢ä¸º Tauri å¯è®¿é—®çš„ URL
      const tauriUrl = convertFileSrc(absolutePath);

      console.log('[CherryEditor] urlProcessor:', {
        originalUrl: url,
        srcType,
        currentFilePath,
        absolutePath,
        tauriUrl,
      });

      return tauriUrl;
    } catch (error) {
      console.error('[CherryEditor] Failed to resolve URL:', error);
      return url;
    }
  },
  // ... å…¶ä»–å›è°ƒ
}
```

**å¤„ç†é€»è¾‘**:
1. **è·³è¿‡åœ¨çº¿èµ„æº**: http/https/data é“¾æ¥ç›´æ¥è¿”å›
2. **éªŒè¯æ–‡ä»¶è·¯å¾„**: æ£€æŸ¥å½“å‰æ ‡ç­¾æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„
3. **è§£æç›¸å¯¹è·¯å¾„**: ä½¿ç”¨ `resolvePath` å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
4. **è½¬æ¢ä¸º Tauri URL**: ä½¿ç”¨ `convertFileSrc` è½¬æ¢ä¸º WebView å¯è®¿é—®çš„ URL
5. **é”™è¯¯å¤„ç†**: å¤±è´¥æ—¶å›é€€åˆ°åŸå§‹ URL

---

## å››ã€å…³é”®æŠ€æœ¯ç‚¹

### 4.1 è·¯å¾„è§£æ

**é—®é¢˜**: JavaScript çš„ `new URL()` API ä¼šå¯¹ä¸­æ–‡è·¯å¾„è¿›è¡Œ URL ç¼–ç ï¼Œå¯¼è‡´ï¼š
- ç¬¬ä¸€æ¬¡ç¼–ç ï¼š`è§£å†³æ–¹æ¡ˆ` â†’ `%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88`
- ç¬¬äºŒæ¬¡ç¼–ç ï¼ˆ`convertFileSrc`ï¼‰ï¼š`%E8` â†’ `%25E8`ï¼ˆåŒé‡ç¼–ç ï¼ï¼‰

**è§£å†³æ–¹æ¡ˆ**: æ‰‹åŠ¨è§£æè·¯å¾„ï¼Œä¸ä½¿ç”¨ `new URL()`ï¼š

```typescript
// âŒ é”™è¯¯ï¼šä½¿ç”¨ new URL()
const resolvedUrl = new URL(relativePath, `file://${baseDir}/`);
let resolvedPath = resolvedUrl.pathname; // ä¸­æ–‡è¢«ç¼–ç 

// âœ… æ­£ç¡®ï¼šæ‰‹åŠ¨è§£æ
const parts = baseDir.split('/');
const relativeParts = relativePath.split('/');
// ... é€æ®µå¤„ç†
```

### 4.2 Windows è·¯å¾„æ ¼å¼

**å‘ç°**: `convertFileSrc` åœ¨ Windows ä¸Šéœ€è¦**åæ–œæ æ ¼å¼çš„å®Œæ•´è·¯å¾„**ï¼ˆåŒ…å«ç›˜ç¬¦ï¼‰ã€‚

**é”™è¯¯ç¤ºä¾‹**:
```typescript
// âŒ ç§»é™¤ç›˜ç¬¦ï¼ˆåŸºäº Tauri v1.x çš„ Issue #7970ï¼‰
const pathWithoutDrive = absolutePath.replace(/^([A-Za-z]):\/(.*)$/, '$2');
convertFileSrc(pathWithoutDrive); // 500 é”™è¯¯ï¼

// âŒ ä½¿ç”¨æ­£æ–œæ 
const pathWithSlash = 'D:/develop/xcyg/.../image.png';
convertFileSrc(pathWithSlash); // 500 é”™è¯¯ï¼
```

**æ­£ç¡®ç¤ºä¾‹**:
```typescript
// âœ… ä½¿ç”¨ Windows åŸç”Ÿæ ¼å¼
const windowsPath = 'D:\\develop\\xcyg\\...\\image.png';
convertFileSrc(windowsPath); // æ­£å¸¸å·¥ä½œï¼
```

**ç»“è®º**: Tauri 2.9.1 çš„ `convertFileSrc` è¡Œä¸ºä¸æ—©æœŸç‰ˆæœ¬ä¸åŒï¼Œéœ€è¦ä¼ å…¥å®Œæ•´çš„ Windows è·¯å¾„ã€‚

### 4.3 Tauri asset protocol é…ç½®

**å¿…é¡»æ»¡è¶³çš„æ¡ä»¶**:

1. **å¯ç”¨ asset protocol**:
   ```json
   "assetProtocol": {
     "enable": true,  // å¿…é¡»ä¸º true
     "scope": ["**"]   // å…è®¸æ‰€æœ‰æ–‡ä»¶
   }
   ```

2. **CSP ä¸­æ·»åŠ  asset åè®®**:
   ```json
   "csp": "img-src 'self' asset: http://asset.localhost ..."
   ```

3. **ä½¿ç”¨ `convertFileSrc` è½¬æ¢è·¯å¾„**:
   ```typescript
   const url = convertFileSrc(absolutePath); // è¿”å› http://asset.localhost/...
   ```

**asset protocol å·¥ä½œåŸç†**:
- `convertFileSrc('D:\\path\\to\\image.png')`
- â†’ è¿”å› `http://asset.localhost/C:/path/to/image.png`
- â†’ Tauri çš„ asset protocol æœåŠ¡å™¨å¤„ç†è¯·æ±‚
- â†’ è¿”å›æœ¬åœ°æ–‡ä»¶å†…å®¹

---

## äº”ã€æµ‹è¯•éªŒè¯

### 5.1 æµ‹è¯•åœºæ™¯

| åœºæ™¯ | Markdown è¯­æ³• | é¢„æœŸç»“æœ |
|------|--------------|---------|
| åŒçº§ç›®å½• | `![å›¾](image.png)` | æ˜¾ç¤º `D:\docs\image.png` |
| å­ç›®å½• | `![å›¾](images/img.png)` | æ˜¾ç¤º `D:\docs\images\img.png` |
| çˆ¶ç›®å½• | `![å›¾](../image.png)` | æ˜¾ç¤º `D:\image.png` |
| åœ¨çº¿å›¾ç‰‡ | `![å›¾](https://example.com/img.png)` | æ˜¾ç¤ºåœ¨çº¿å›¾ç‰‡ |
| ä¸­æ–‡è·¯å¾„ | `![å›¾](å›¾ç‰‡/å›¾.png)` | æ˜¾ç¤º `D:\docs\å›¾ç‰‡\å›¾.png` |
| Untitled æ–‡ä»¶ | `![å›¾](image.png)` | è¿”å›åŸå§‹ URLï¼ˆæ— æ³•è§£æï¼‰ |

### 5.2 è°ƒè¯•æ—¥å¿—

å¯ç”¨æ—¥å¿—åï¼Œæ§åˆ¶å°åº”æ˜¾ç¤ºï¼š

```javascript
[CherryEditor] urlProcessor: {
  originalUrl: 'images/image_0001.png',
  srcType: 'image',
  currentFilePath: 'D:\\develop\\xcyg\\...\\è§£å†³æ–¹æ¡ˆ\\20260126\\20260126è§£å†³æ–¹æ¡ˆ.md',
  absolutePath: 'D:\\develop\\xcyg\\...\\è§£å†³æ–¹æ¡ˆ\\20260126\\images\\image_0001.png',
  tauriUrl: 'http://asset.localhost/C:/develop/.../images/image_0001.png'
}
```

**å…³é”®æ£€æŸ¥ç‚¹**:
- âœ… `absolutePath` æ˜¯å®Œæ•´çš„ Windows è·¯å¾„ï¼ˆåŒ…å«ç›˜ç¬¦ï¼Œåæ–œæ åˆ†éš”ï¼‰
- âœ… `tauriUrl` ä»¥ `http://asset.localhost/` å¼€å¤´
- âœ… ä¸­æ–‡è·¯å¾„æ­£ç¡®æ˜¾ç¤ºï¼ˆæœªè¢«åŒé‡ç¼–ç ï¼‰

---

## å…­ã€é‡åˆ°çš„å‘å’Œæ•™è®­

### 6.1 é”™è¯¯å‚è€ƒ Issue #7970

**é—®é¢˜**: Issue #7970 æ˜¯é’ˆå¯¹ Tauri v1.x å’Œæ—©æœŸ v2.0 alpha ç‰ˆæœ¬çš„ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ç§»é™¤ç›˜ç¬¦ã€‚

**å®é™…æƒ…å†µ**: Tauri 2.9.1 çš„ `convertFileSrc` è¡Œä¸ºå·²æ”¹å˜ï¼Œéœ€è¦ä¿ç•™ç›˜ç¬¦ã€‚

**æ•™è®­**:
- âš ï¸ æ³¨æ„ GitHub Issue çš„é€‚ç”¨ç‰ˆæœ¬
- âœ… ä¼˜å…ˆæŸ¥é˜…å®˜æ–¹æ–‡æ¡£çš„æœ€æ–°ç‰ˆæœ¬
- âœ… é€šè¿‡å®éªŒéªŒè¯ API çš„å®é™…è¡Œä¸º

### 6.2 è·¯å¾„ç¼–ç é—®é¢˜

**é—®é¢˜**: ä½¿ç”¨ `new URL()` å¯¼è‡´ä¸­æ–‡è·¯å¾„è¢«åŒé‡ç¼–ç ã€‚

**é”™è¯¯ç°è±¡**:
```
original: è§£å†³æ–¹æ¡ˆ
after URL: %E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88
after convertFileSrc: %25E8%25A7... (åŒé‡ç¼–ç ï¼)
```

**æ•™è®­**:
- âŒ ä¸è¦ç”¨ URL API æ¥è§£ææ–‡ä»¶è·¯å¾„
- âœ… ä½¿ç”¨æ‰‹åŠ¨è·¯å¾„è§£ææˆ–ä¸“é—¨çš„ path åº“
- âœ… è°ƒè¯•æ—¶ä»”ç»†æ£€æŸ¥ URL ç¼–ç æƒ…å†µ

### 6.3 Tauri é…ç½®ä¾èµ–

**é—®é¢˜**: ä¿®æ”¹ `tauri.conf.json` åå¿˜è®°é‡å¯åº”ç”¨ï¼Œå¯¼è‡´é…ç½®ä¸ç”Ÿæ•ˆã€‚

**æ•™è®­**:
- âš ï¸ Tauri é…ç½®æ–‡ä»¶ä¿®æ”¹åå¿…é¡»é‡æ–°å¯åŠ¨åº”ç”¨
- âœ… å¼€å‘æ—¶é¢‘ç¹æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
- âœ… é‡åˆ°åè®®é”™è¯¯æ—¶é¦–å…ˆæ£€æŸ¥ assetProtocol é…ç½®

---

## ä¸ƒã€ç›¸å…³æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `src/utils/pathUtils.ts` | âœ¨ æ–°å»ºæ–‡ä»¶ï¼šè·¯å¾„è§£æå·¥å…·æ¨¡å— |
| `src/components/CherryEditor.vue` | âœ¨ æ·»åŠ  `urlProcessor` å›è°ƒ<br>ğŸ“¥ å¯¼å…¥ `convertFileSrc` å’Œ `resolvePath` |
| `src/App.vue` | â™»ï¸ ä½¿ç”¨æ–°çš„ `resolvePath` å·¥å…·å‡½æ•° |
| `src-tauri/tauri.conf.json` | âš™ï¸ å¯ç”¨ `assetProtocol`<br>âš™ï¸ é…ç½® CSP å…è®¸ asset åè®® |

---

## å…«ã€å‚è€ƒæ–‡æ¡£

- [Cherry Markdown å®˜æ–¹æ–‡æ¡£](https://tencent.github.io/cherry-markdown/)
- [Tauri Core API - convertFileSrc](https://v2.tauri.app/reference/javascript/api/namespacecore/)
- [Tauri Issue #8599](https://github.com/tauri-apps/tauri/issues/8599) - Windows èµ„æºè®¿é—®é—®é¢˜
- [Tauri Issue #7970](https://github.com/tauri-apps/tauri/issues/7970) - convertFileSrc åœ¨ Windows ä¸Šçš„è¡Œä¸ºï¼ˆæ³¨æ„ç‰ˆæœ¬å·®å¼‚ï¼‰
- [Tauri Issue #8244](https://github.com/tauri-apps/tauri/issues/8244) - convertFileSrc æœ¬åœ°æ–‡ä»¶è®¿é—®

---

## ä¹ã€æ€»ç»“

æœ¬æ¬¡é—®é¢˜çš„æ ¸å¿ƒæ˜¯ **Cherry Markdown åœ¨ Tauri æ¡Œé¢åº”ç”¨ç¯å¢ƒä¸­éœ€è¦ç‰¹æ®Šå¤„ç†å›¾ç‰‡è·¯å¾„**ã€‚é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªå…³é”®ä¿®æ”¹è§£å†³äº†é—®é¢˜ï¼š

1. âœ… **æ·»åŠ  `urlProcessor` å›è°ƒ**ï¼šæ‹¦æˆªå›¾ç‰‡ URLï¼Œè¿›è¡Œè·¯å¾„è½¬æ¢
2. âœ… **å¯ç”¨ Tauri asset protocol**ï¼šå…è®¸ WebView è®¿é—®æœ¬åœ°æ–‡ä»¶
3. âœ… **æ­£ç¡®å¤„ç†è·¯å¾„æ ¼å¼**ï¼šä½¿ç”¨ Windows åŸç”Ÿè·¯å¾„æ ¼å¼ï¼Œé¿å…åŒé‡ç¼–ç 

**å…³é”®ç»éªŒ**:
- ğŸ” é—®é¢˜å®šä½è¦ç³»ç»ŸåŒ–ï¼ˆä»ç°è±¡â†’é…ç½®â†’æ–‡æ¡£â†’å®éªŒï¼‰
- ğŸ“š ä¼˜å…ˆæŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œæ³¨æ„ç‰ˆæœ¬å·®å¼‚
- ğŸ§ª é€šè¿‡å®éªŒéªŒè¯ API çš„å®é™…è¡Œä¸º
- ğŸ“ è¯¦ç»†è®°å½•è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºè¿½è¸ªé—®é¢˜

**åç»­ä¼˜åŒ–å»ºè®®**:
- è€ƒè™‘æ·»åŠ å›¾ç‰‡åŠ è½½å¤±è´¥çš„å‹å¥½æç¤º
- æ”¯æŒæ›´å¤šå›¾ç‰‡æ ¼å¼ï¼ˆSVGã€WEBP ç­‰ï¼‰
- ä¼˜åŒ–å›¾ç‰‡åŠ è½½æ€§èƒ½ï¼ˆæ‡’åŠ è½½ã€ç¼“å­˜ç­‰ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-26
**ä½œè€…**: Claude Code
